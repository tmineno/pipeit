---
source: compiler/tests/snapshot_hir.rs
expression: output
---
HirProgram (2 consts, 1 params, 2 directives, 3 tasks)
  const lp_coeff = [0.1, 0.2, 0.4, 0.2, 0.1]
  const bp_coeff = [0.05, -0.1, 0.3, -0.1, 0.05]
  param agc_gain = 1
  set mem = 134217728B
  set overrun = drop
  task 'capture' @ 10000000 (pipeline)
    constant(0) | fft(256) | ~spec0 | c2r() | fir(:lp_coeff) | add(^fb) | mul($agc_gain) | ~agc | ?agc_out -> filtered
    ^agc | delay(1, 0) | ~fb
    ^spec0 | mag() | stdout()
    constant(0) | fft(256) | c2r() | ~raw1 | fir(:bp_coeff) | ?bp_out -> narrow
    ^raw1 | fir(:lp_coeff) -> wideband
  task 'analysis' @ 10000000 (pipeline)
    buffer_read(filtered) | decimate(256) | ~dec_f | csvwrite("filtered.csv")
    ^dec_f | stdout()
    buffer_read(narrow) | decimate(256) | csvwrite("narrow.csv")
    buffer_read(wideband) | decimate(256) | csvwrite("wideband.csv")
  task 'monitor' @ 10000000 (modal, ctrl=buffer:ctl)
    control:
      constant(0) | correlate() | detect() -> ctl
    mode 'sync':
      constant(0) | fir(:lp_coeff) | ?sync_probe -> sync_buf
    mode 'data':
      constant(0) | fft(256) | c2r() | fir(:bp_coeff) | ?data_probe -> data_buf
