# v0.4.4 Release Notes

## Breaking Changes

### `--actor-meta` is now required for compilation stages

`--actor-meta <manifest>` is required for `--emit cpp|exe|build-info|graph|graph-dot|schedule|timing-chart`. Omitting it produces error E0700 (exit code 2).

**Migration:**

```bash
# Before (v0.4.3):
pcc source.pdl -I runtime/libpipit/include --emit cpp -o out.cpp

# After (v0.4.4):
# Step 1: generate manifest
pcc --emit manifest -I runtime/libpipit/include -I examples -o actors.meta.json

# Step 2: compile with manifest
pcc source.pdl --actor-meta actors.meta.json -I runtime/libpipit/include --emit cpp -o out.cpp
```

`--emit manifest` and `--emit ast` do not require `--actor-meta`.

See ADR-033 for rationale.

## New Features

### Preprocessor-based actor metadata extraction (ADR-032)

`--emit manifest` now uses the C++ preprocessor to extract actor metadata instead of text scanning. This correctly resolves `#include`, `#ifdef`, and preprocessor conditionals â€” actors behind guards that were previously invisible are now captured.

The preprocessor is invoked via `--cc` (default: `clang++`) with `-E -P -x c++ -std=c++20`.

### E0700 diagnostic

New diagnostic code E0700 for missing `--actor-meta`. Respects `--diagnostic-format` (human and JSON) with stage-aware messages and hints.

### Centralized usage-error emitter

All CLI usage errors now respect `--diagnostic-format`, including JSON output.

## Internal Changes

- Text scanner in `registry.rs` replaced and removed (~440 lines deleted).
- New `RegistryError::PreprocessorError` variant for compiler/preprocessing failures (exit code 3).
